---
- name: Set up container environments
  hosts:
    - cpu
  vars:
    use_proxy: "{{ http_proxy is defined }}"
    use_nvidia_docker: false
    ignore_running_containers: false
  environment:
    http_proxy: "{{ http_proxy if http_proxy is defined else '' }}"
    https_proxy: "{{ https_proxy if https_proxy is defined else '' }}"
    no_proxy: "{{ no_proxy if no_proxy is defined else '' }}"
  roles:
    - role: docker
      when: ansible_os_family in ['RedHat', 'Debian']
    - role: kubernetes
      when: ansible_os_family in ['RedHat', 'Debian']

- name: Set up container environments with GPU
  hosts:
    - gpu
  vars:
    use_proxy: "{{ http_proxy is defined }}"
    use_nvidia_docker: true
    ignore_running_containers: false
  environment:
    http_proxy: "{{ http_proxy if http_proxy is defined else '' }}"
    https_proxy: "{{ https_proxy if https_proxy is defined else '' }}"
    no_proxy: "{{ no_proxy if no_proxy is defined else '' }}"
  roles:
    - role: docker
      when: ansible_os_family in ['RedHat', 'Debian']
    - role: kubernetes
      when: ansible_os_family in ['RedHat', 'Debian']
